<div style="max-width: 1200px; margin: 0 auto; padding: 20px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">
  <p style="color: green"><%= notice %></p>

  <% content_for :title, "Tickets" %>

  <h1 style="margin-bottom: 30px; color: #333;">Tickets Manager</h1>

  <!-- Search and Filter Section -->
  <div style="background: #f5f5f5; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
    <h2 style="font-size: 18px; margin-top: 0; color: #333;">Search & Filter</h2>
    
    <%= form_with url: tickets_path, method: :get, local: true do |f| %>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
        <div>
          <%= f.text_field :search, placeholder: "Search by title or description", value: params[:search], style: "width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;" %>
        </div>
        
        <div>
          <%= f.select :status, [["All Statuses", ""], ["Open", "open"], ["In Progress", "in_progress"], ["Closed", "closed"]], { selected: params[:status] }, { style: "width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;" } %>
        </div>
        
        <div>
          <%= f.select :priority, [["All Priorities", ""], ["Low", "low"], ["Medium", "medium"], ["High", "high"], ["Urgent", "urgent"]], { selected: params[:priority] }, { style: "width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;" } %>
        </div>
        
        <div>
          <%= f.text_field :created_by, placeholder: "Filter by creator", value: params[:created_by], style: "width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;" %>
        </div>
        
        <div style="display: flex; gap: 10px; align-items: flex-end;">
          <%= f.submit "Filter", style: "padding: 8px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; flex: 1;" %>
          <%= link_to "Clear", tickets_path, style: "padding: 8px 20px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer; text-align: center; text-decoration: none;" %>
        </div>
      </div>
    <% end %>
  </div>

  <!-- Tickets List -->
  <div style="margin-bottom: 30px;">
    <% if @tickets.any? %>
      <p style="color: #666; margin-bottom: 20px;"><strong><%= @tickets.count %> ticket(s) found</strong></p>
      
      <div id="tickets" style="display: grid; gap: 15px;">
        <% @tickets.each do |ticket| %>
          <div style="border: 1px solid #ddd; border-radius: 8px; padding: 20px; background: white; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
              <h3 style="margin: 0; color: #333; font-size: 18px;">
                <%= link_to ticket.title, ticket, style: "color: #007bff; text-decoration: none;" %>
              </h3>
              <div style="display: flex; gap: 10px;">
                <span style="padding: 4px 12px; background: #e7f3ff; color: #004085; border-radius: 20px; font-size: 12px; font-weight: 500;">
                  <%= ticket.status.upcase %>
                </span>
                <span style="padding: 4px 12px; background: 
                  <%= case ticket.priority
                      when 'urgent' then '#fff3cd'
                      when 'high' then '#f8d7da'
                      when 'medium' then '#d1ecf1'
                      else '#d4edda'
                      end %>
                  ; color: #333; border-radius: 20px; font-size: 12px; font-weight: 500;">
                  <%= ticket.priority.upcase %>
                </span>
              </div>
            </div>
            
            <% if ticket.description.present? %>
              <p style="color: #666; margin: 10px 0; line-height: 1.5;">
                <%= truncate(ticket.description, length: 150) %>
              </p>
            <% else %>
              <p style="color: #999; margin: 10px 0; font-style: italic;">No description provided</p>
            <% end %>
            
            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee; font-size: 12px; color: #666;">
              <div>
                <strong>Created by:</strong> <%= ticket.created_by || "Unknown" %> | 
                <strong>Created:</strong> <%= time_ago_in_words(ticket.created_at) %> ago
              </div>
              <div style="display: flex; gap: 10px;">
                <%= link_to "View", ticket, style: "color: #007bff; text-decoration: none; font-weight: 500;" %>
                <%= link_to "Edit", edit_ticket_path(ticket), style: "color: #28a745; text-decoration: none; font-weight: 500;" %>
                <%= link_to "Delete", ticket, method: :delete, data: { confirm: "Are you sure?" }, style: "color: #dc3545; text-decoration: none; font-weight: 500;" %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <p style="color: #666; text-align: center; padding: 40px; background: #f9f9f9; border-radius: 8px;">
        No tickets found. <%= link_to "Create one now!", new_ticket_path, style: "color: #007bff; text-decoration: none;" %>
      </p>
    <% end %>
  </div>

  <!-- New Ticket Button -->
  <div style="text-align: center;">
    <%= link_to "New Ticket", new_ticket_path, style: "display: inline-block; padding: 12px 30px; background: #28a745; color: white; text-decoration: none; border-radius: 4px; font-weight: 500; cursor: pointer;" %>
  </div>
</div>
